@model MaiAmTinhThuong.Models.MaiAm

<div class="container py-5" style="max-width: 1100px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #fafafa; border-radius: 12px; box-shadow: 0 6px 15px rgb(0 0 0 / 0.05); padding: 30px;">

    <h1 class="mb-3 fw-bold" style="color: #5a6d7c;">@Model.Name</h1>
    <p class="lead" style="color: #6c7b88;">@Model.Description</p>

    <div class="mb-4">
        <span class="badge rounded-pill" style="background-color: #d7e6f7; color: #4a6785; font-weight: 600; font-size: 1rem; padding: 0.5em 1em; margin-right: 1rem;">
            <i class="bi bi-geo-alt-fill me-1"></i> Địa chỉ: @Model.Address
        </span>
        <span class="badge rounded-pill" style="background-color: #d0f0e7; color: #3d7d65; font-weight: 600; font-size: 1rem; padding: 0.5em 1em;">
            <i class="bi bi-cash-stack me-1"></i> Quỹ tài trợ: @Model.Fund.ToString("N0") VNĐ
        </span>
    </div>

    <ul class="nav nav-tabs mb-4" id="maiAmTabs" role="tablist" style="border-bottom: 2px solid #cbd4db;">
        <li class="nav-item" role="presentation">
            <button class="nav-link active fw-semibold" id="supportRequests-tab" data-bs-toggle="tab" data-bs-target="#supportRequests" type="button" role="tab" aria-controls="supportRequests" aria-selected="true" style="color: #54718a;">
                Người cần hỗ trợ <span class="badge rounded-pill" style="background-color: #f4cccc; color: #a85a5a;">@Model.SupportRequests.Count</span>
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link fw-semibold" id="supporters-tab" data-bs-toggle="tab" data-bs-target="#supporters" type="button" role="tab" aria-controls="supporters" aria-selected="false" style="color: #54718a;">
                Người hỗ trợ <span class="badge rounded-pill" style="background-color: #cde4dd; color: #3e6d55;">@Model.SupporterMaiAms.Count</span>
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link fw-semibold" id="statistics-tab" data-bs-toggle="tab" data-bs-target="#statistics" type="button" role="tab" aria-controls="statistics" aria-selected="false" style="color: #54718a;">
                Thống kê
            </button>
        </li>
    </ul>

    <div class="tab-content">

        <!-- Người cần hỗ trợ -->
        <div class="tab-pane fade show active" id="supportRequests" role="tabpanel" aria-labelledby="supportRequests-tab">
            <div class="table-responsive shadow-sm rounded-3 mb-4" style="box-shadow: 0 4px 10px rgba(150, 160, 170, 0.15);">
                <table class="table table-striped table-hover align-middle mb-0" style="color: #576971;">
                    <thead class="table-light" style="background-color: #e3ebf2;">
                        <tr>
                            <th>Tên</th>
                            <th>Tuổi</th>
                            <th>Hoàn cảnh</th>
                            <th>Tình trạng sức khỏe</th>
                            <th>Chi tiết</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var request in Model.SupportRequests)
                        {
                            <tr>
                                <td>@request.Name</td>
                                <td class="text-center">@request.Age</td>
                                <td>@(request.Reason.Length > 40 ? request.Reason.Substring(0, 40) + "..." : request.Reason)</td>
                                <td>@(request.HealthStatus.Length > 40 ? request.HealthStatus.Substring(0, 40) + "..." : request.HealthStatus)</td>
                                <td class="text-center">
                                    <button type="button" class="btn btn-sm" style="background-color: #b8d8f7; color: #305e9e; border: none;" data-bs-toggle="modal" data-bs-target="#detailModal_@request.Id">
                                        Xem
                                    </button>
                                </td>
                            </tr>
                            <!-- Modal... (giữ nguyên như trước, bạn có thể thêm style nhẹ cho modal nếu cần) -->
                        }
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Người hỗ trợ -->
        <div class="tab-pane fade" id="supporters" role="tabpanel" aria-labelledby="supporters-tab">
            <div class="table-responsive shadow-sm rounded-3 mb-4" style="box-shadow: 0 4px 10px rgba(150, 160, 170, 0.15);">
                <table class="table table-striped table-hover align-middle mb-0" style="color: #576971;">
                    <thead class="table-light" style="background-color: #e3ebf2;">
                        <tr>
                            <th>Tên</th>
                            <th>Tuổi</th>
                            <th>Loại hỗ trợ</th>
                            <th>Chi tiết</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var sma in Model.SupporterMaiAms)
                        {
                            var supporter = sma.Supporter;
                            <tr>
                                <td>@supporter.Name</td>
                                <td class="text-center">@supporter.Age</td>
                                <td>@string.Join(", ", supporter.SupporterSupportTypes.Select(sst => sst.SupportType.Name))</td>
                                <td class="text-center">
                                    <button type="button" class="btn btn-sm" style="background-color: #c9e5db; color: #2a6041; border: none;" data-bs-toggle="modal" data-bs-target="#supporterDetailModal_@supporter.Id">
                                        Xem
                                    </button>
                                </td>
                            </tr>
                            <!-- Modal... giữ nguyên -->
                        }
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Thống kê -->
        <div class="tab-pane fade" id="statistics" role="tabpanel" aria-labelledby="statistics-tab">
            <div class="card shadow-sm rounded-3 p-4 mb-4" style="background-color: #f5f9fc; border: none;">
                <canvas id="supportChart" style="max-height: 300px;"></canvas>
            </div>

            <div class="row text-center">
                <div class="col-md-4 mb-3">
                    <div class="p-3 rounded" style="background-color: #fce8e8; color: #a65b5b; box-shadow: 0 4px 10px rgb(172 106 106 / 0.15);">
                        <h5>@ViewBag.TotalSupportRequests</h5>
                        <p class="mb-0 fw-semibold">Người cần hỗ trợ</p>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="p-3 rounded" style="background-color: #d9f0e5; color: #2f6a4f; box-shadow: 0 4px 10px rgb(54 123 82 / 0.15);">
                        <h5>@ViewBag.TotalSupporters</h5>
                        <p class="mb-0 fw-semibold">Người hỗ trợ</p>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="p-3 rounded" style="background-color: #e6f1f8; color: #3a597a; box-shadow: 0 4px 10px rgb(51 93 129 / 0.15);">
                        <h5>@Model.Fund.ToString("N0") VNĐ</h5>
                        <p class="mb-0 fw-semibold">Quỹ tài trợ hiện tại</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        var ctx = document.getElementById('supportChart').getContext('2d');
        var supportChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Người cần hỗ trợ', 'Người hỗ trợ'],
                datasets: [{
                    label: 'Số lượng',
                    data: [@ViewBag.TotalSupportRequests, @ViewBag.TotalSupporters],
                    backgroundColor: ['#f4a9a9cc', '#8ac5a9cc'],
                    borderColor: ['#a65b5bcc', '#2f6a4fcc'],
                    borderWidth: 1
                }]
            },
            options: {
                scales: { y: { beginAtZero: true, precision: 0 } },
                plugins: { legend: { display: false } }
            }
        });
    </script>
}
